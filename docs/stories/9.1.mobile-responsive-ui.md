# Story 9.1: Mobile-Responsive UI & Touch Optimization

## Status
Draft

## Story
**As a** mobile user,
**I want** a fully responsive interface optimized for touch,
**so that** I can play D&D on my phone or tablet seamlessly.

## Acceptance Criteria
1. All pages responsive on mobile (320px+), tablet (768px+), desktop (1024px+)
2. Navigation collapses to hamburger menu on mobile
3. Character sheet adapts to single-column layout on mobile
4. Table page chat interface uses bottom sheet on mobile
5. Dice roller optimized for touch (larger buttons, swipe gestures)
6. Combat tracker shows condensed view on mobile
7. Tables discovery uses vertical scrolling cards on mobile
8. Touch gestures: swipe to dismiss modals, pull-to-refresh

## Tasks / Subtasks

- [ ] Audit current breakpoints (AC: 1)
  - [ ] Review TailwindCSS config for breakpoints
  - [ ] Ensure: sm (640px), md (768px), lg (1024px), xl (1280px)
  - [ ] Test all pages at each breakpoint
  - [ ] Document responsive design patterns

- [ ] Implement responsive navigation (AC: 2)
  - [ ] Desktop: full horizontal navbar
  - [ ] Mobile: hamburger menu icon (â˜°)
  - [ ] Mobile menu: slide-in drawer from left
  - [ ] Menu items: Home, Characters, Tables, Dice, Profile
  - [ ] Close on route change or outside click

- [ ] Make character sheet mobile-responsive (AC: 3)
  - [ ] Desktop: 2-column layout (stats left, details right)
  - [ ] Mobile: single column, stacked sections
  - [ ] Ability scores: 2x3 grid on mobile (instead of 6 across)
  - [ ] Skills: full-width list on mobile
  - [ ] Tabs: horizontal scroll on mobile if too many

- [ ] Adapt table page for mobile (AC: 4)
  - [ ] Desktop: 3-column layout (sidebar, chat, character sheet)
  - [ ] Mobile: single view with bottom sheet
  - [ ] Bottom sheet shows chat by default
  - [ ] Swipe up to expand, swipe down to minimize
  - [ ] Tabs: Chat, Players, Character Sheet
  - [ ] Floating action button (FAB) for dice roller

- [ ] Optimize dice roller for touch (AC: 5)
  - [ ] Dice buttons: min 44px height for touch targets
  - [ ] Large tap area for d20, d12, d10, d8, d6, d4
  - [ ] Swipe left/right to change dice type
  - [ ] Swipe up to add modifier
  - [ ] Haptic feedback on roll (if supported)

- [ ] Create mobile combat tracker (AC: 6)
  - [ ] Desktop: table view with all columns
  - [ ] Mobile: card view, one combatant per card
  - [ ] Swipe left on card to reveal actions (damage, heal, remove)
  - [ ] Current turn highlighted with border
  - [ ] HP bars: full width on mobile

- [ ] Make tables discovery mobile-friendly (AC: 7)
  - [ ] Desktop: grid layout (3 columns)
  - [ ] Mobile: vertical list, one card per row
  - [ ] Filters: collapsible drawer on mobile
  - [ ] Infinite scroll or pagination
  - [ ] Pull-to-refresh to reload

- [ ] Implement touch gestures (AC: 8)
  - [ ] Swipe down to dismiss modals/sheets
  - [ ] Pull-to-refresh on lists (tables, characters)
  - [ ] Swipe left/right to navigate between tabs
  - [ ] Long press for context menu (copy, edit, delete)

- [ ] Add mobile-specific components (AC: 4, 8)
  - [ ] BottomSheet component (draggable, snap points)
  - [ ] MobileDrawer component (slide-in navigation)
  - [ ] FloatingActionButton component (dice, create)
  - [ ] PullToRefresh component

- [ ] Optimize touch targets (AC: 5)
  - [ ] Minimum 44px height for all interactive elements
  - [ ] Spacing between buttons: min 8px
  - [ ] Increase padding on mobile inputs
  - [ ] Larger checkbox/radio sizes

- [ ] Test on real devices (AC: 1-8)
  - [ ] iPhone (Safari, Chrome)
  - [ ] Android (Chrome, Samsung Internet)
  - [ ] iPad (Safari)
  - [ ] Test orientations: portrait and landscape
  - [ ] Test gestures: swipe, tap, long press, pinch

- [ ] Add viewport meta tag (AC: 1)
  - [ ] `<meta name="viewport" content="width=device-width, initial-scale=1">`
  - [ ] Disable zoom on inputs (optional)
  - [ ] Test viewport settings

## Dev Notes

### TailwindCSS Breakpoints
**[Source: Front-End Spec Section 2.3 - Responsive Design]**

```javascript
// tailwind.config.js
module.exports = {
  theme: {
    screens: {
      sm: '640px',  // Mobile landscape
      md: '768px',  // Tablet
      lg: '1024px', // Desktop
      xl: '1280px', // Large desktop
      '2xl': '1536px',
    },
  },
};
```

**Responsive utility classes:**
```tsx
// Example: 1 column on mobile, 3 on desktop
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  {items.map((item) => <Card key={item.id} {...item} />)}
</div>
```

### Mobile Navigation Component
**[Source: shadcn/ui Sheet component]**

```typescript
// apps/web/src/components/MobileNav.tsx
'use client';

import { useState } from 'react';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import { Button } from '@/components/ui/button';
import { Menu, Home, User, Dice6, Users } from 'lucide-react';
import Link from 'next/link';

export function MobileNav() {
  const [isOpen, setIsOpen] = useState(false);

  const links = [
    { href: '/dashboard', label: 'Home', icon: Home },
    { href: '/characters', label: 'Characters', icon: User },
    { href: '/tables', label: 'Tables', icon: Users },
    { href: '/dice', label: 'Dice Roller', icon: Dice6 },
  ];

  return (
    <Sheet open={isOpen} onOpenChange={setIsOpen}>
      <SheetTrigger asChild>
        <Button variant="ghost" size="icon" className="md:hidden">
          <Menu className="h-6 w-6" />
        </Button>
      </SheetTrigger>

      <SheetContent side="left" className="w-72">
        <nav className="flex flex-col gap-4 mt-8">
          {links.map((link) => (
            <Link
              key={link.href}
              href={link.href}
              onClick={() => setIsOpen(false)}
              className="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-800 transition-colors"
            >
              <link.icon className="h-5 w-5" />
              <span className="font-medium">{link.label}</span>
            </Link>
          ))}
        </nav>
      </SheetContent>
    </Sheet>
  );
}
```

**Header with mobile nav:**
```typescript
// apps/web/src/components/Header.tsx
import { MobileNav } from './MobileNav';

export function Header() {
  return (
    <header className="border-b border-gray-800">
      <div className="container mx-auto px-4 py-3 flex items-center justify-between">
        <div className="flex items-center gap-4">
          <MobileNav />
          <h1 className="text-xl font-bold">IA-RPG</h1>
        </div>

        {/* Desktop nav */}
        <nav className="hidden md:flex items-center gap-6">
          <Link href="/dashboard">Home</Link>
          <Link href="/characters">Characters</Link>
          <Link href="/tables">Tables</Link>
          <Link href="/dice">Dice</Link>
        </nav>

        {/* User menu */}
        <UserMenu />
      </div>
    </header>
  );
}
```

### Responsive Character Sheet
**[Source: Front-End Spec Section 4.2 - Character Sheet]**

```typescript
// apps/web/src/components/CharacterSheet.tsx
'use client';

import { Character } from '@iarpg/db';

interface CharacterSheetProps {
  character: Character;
}

export function CharacterSheet({ character }: CharacterSheetProps) {
  const abilities = ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA'];

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 className="text-3xl font-bold">{character.name}</h1>
          <p className="text-gray-400">
            Level {character.level} {character.race} {character.class}
          </p>
        </div>
      </div>

      {/* Desktop: 2 columns, Mobile: single column */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Left column: Stats */}
        <div className="space-y-6">
          {/* Ability Scores: 3x2 grid on mobile, 6 across on desktop */}
          <div className="grid grid-cols-3 md:grid-cols-6 lg:grid-cols-3 gap-3">
            {abilities.map((ability) => (
              <div
                key={ability}
                className="bg-gray-800 rounded-lg p-4 text-center"
              >
                <div className="text-xs text-gray-400 mb-1">{ability}</div>
                <div className="text-2xl font-bold">
                  {character.abilityScores[ability]}
                </div>
                <div className="text-sm text-gray-400">
                  {getModifier(character.abilityScores[ability])}
                </div>
              </div>
            ))}
          </div>

          {/* HP, AC, Speed */}
          <div className="grid grid-cols-3 gap-3">
            <StatCard label="HP" value={`${character.hp}/${character.maxHp}`} />
            <StatCard label="AC" value={character.ac} />
            <StatCard label="Speed" value={`${character.speed}ft`} />
          </div>
        </div>

        {/* Right column: Details */}
        <div className="space-y-6">
          {/* Skills list: full width on mobile */}
          <div className="bg-gray-800 rounded-lg p-4">
            <h3 className="font-bold mb-3">Skills</h3>
            <div className="space-y-2">
              {character.skills.map((skill) => (
                <div key={skill.name} className="flex justify-between text-sm">
                  <span>{skill.name}</span>
                  <span>{skill.modifier}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

function StatCard({ label, value }: { label: string; value: string | number }) {
  return (
    <div className="bg-gray-800 rounded-lg p-4 text-center">
      <div className="text-xs text-gray-400 mb-1">{label}</div>
      <div className="text-xl font-bold">{value}</div>
    </div>
  );
}

function getModifier(score: number): string {
  const mod = Math.floor((score - 10) / 2);
  return mod >= 0 ? `+${mod}` : `${mod}`;
}
```

### Bottom Sheet Component for Mobile Table Page
**[Source: React Spring bottom sheet library]**

```bash
pnpm add react-spring-bottom-sheet
```

```typescript
// apps/web/src/components/BottomSheet.tsx
'use client';

import { BottomSheet as ReactBottomSheet } from 'react-spring-bottom-sheet';
import 'react-spring-bottom-sheet/dist/style.css';

interface BottomSheetProps {
  isOpen: boolean;
  onDismiss: () => void;
  children: React.ReactNode;
  snapPoints?: number[];
}

export function BottomSheet({
  isOpen,
  onDismiss,
  children,
  snapPoints = [0.9, 0.5, 0.2],
}: BottomSheetProps) {
  return (
    <ReactBottomSheet
      open={isOpen}
      onDismiss={onDismiss}
      snapPoints={({ maxHeight }) => snapPoints.map((p) => maxHeight * p)}
      blocking={false}
    >
      <div className="p-4">{children}</div>
    </ReactBottomSheet>
  );
}
```

**Mobile Table Page:**
```typescript
// apps/web/src/app/tables/[tableId]/page.tsx (mobile version)
'use client';

import { useState } from 'react';
import { BottomSheet } from '@/components/BottomSheet';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Dice6 } from 'lucide-react';

export default function TablePage({ params }: { params: { tableId: string } }) {
  const [sheetOpen, setSheetOpen] = useState(true);
  const [activeTab, setActiveTab] = useState('chat');

  return (
    <div className="h-screen flex flex-col">
      {/* Desktop: 3-column layout */}
      <div className="hidden md:grid md:grid-cols-[250px_1fr_300px] h-full">
        {/* Sidebar, Chat, Character Sheet */}
      </div>

      {/* Mobile: Single view with bottom sheet */}
      <div className="md:hidden relative h-full">
        {/* Background: Map or combat tracker */}
        <div className="h-full bg-gray-900 p-4">
          <h1 className="text-2xl font-bold">Table Name</h1>
        </div>

        {/* Floating dice button */}
        <button
          className="fixed bottom-24 right-6 w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center shadow-lg"
          onClick={() => {/* Open dice roller */}}
        >
          <Dice6 className="w-6 h-6" />
        </button>

        {/* Bottom sheet */}
        <BottomSheet isOpen={sheetOpen} onDismiss={() => setSheetOpen(false)}>
          <Tabs value={activeTab} onValueChange={setActiveTab}>
            <TabsList className="w-full grid grid-cols-3">
              <TabsTrigger value="chat">Chat</TabsTrigger>
              <TabsTrigger value="players">Players</TabsTrigger>
              <TabsTrigger value="character">Character</TabsTrigger>
            </TabsList>

            <TabsContent value="chat" className="h-96 overflow-y-auto">
              {/* Chat messages */}
            </TabsContent>

            <TabsContent value="players" className="h-96 overflow-y-auto">
              {/* Player list */}
            </TabsContent>

            <TabsContent value="character" className="h-96 overflow-y-auto">
              {/* Character sheet */}
            </TabsContent>
          </Tabs>
        </BottomSheet>
      </div>
    </div>
  );
}
```

### Touch-Optimized Dice Roller
```typescript
// apps/web/src/components/DiceRollerMobile.tsx
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { motion } from 'framer-motion';

const diceTypes = [4, 6, 8, 10, 12, 20, 100];

export function DiceRollerMobile() {
  const [selectedDice, setSelectedDice] = useState(20);
  const [modifier, setModifier] = useState(0);
  const [result, setResult] = useState<number | null>(null);

  const rollDice = () => {
    const roll = Math.floor(Math.random() * selectedDice) + 1;
    setResult(roll + modifier);

    // Haptic feedback (if supported)
    if ('vibrate' in navigator) {
      navigator.vibrate(50);
    }
  };

  return (
    <div className="p-6 space-y-6">
      {/* Result display */}
      <motion.div
        className="bg-gray-800 rounded-2xl p-8 text-center"
        animate={{ scale: result ? [1, 1.1, 1] : 1 }}
        transition={{ duration: 0.3 }}
      >
        {result !== null ? (
          <div className="text-6xl font-bold">{result}</div>
        ) : (
          <div className="text-4xl text-gray-400">Roll the dice!</div>
        )}
      </motion.div>

      {/* Dice selection: Horizontal scroll */}
      <div className="overflow-x-auto">
        <div className="flex gap-3 pb-2">
          {diceTypes.map((dice) => (
            <button
              key={dice}
              onClick={() => setSelectedDice(dice)}
              className={`flex-shrink-0 w-16 h-16 rounded-lg font-bold transition-all ${
                selectedDice === dice
                  ? 'bg-blue-600 scale-110'
                  : 'bg-gray-700'
              }`}
            >
              d{dice}
            </button>
          ))}
        </div>
      </div>

      {/* Modifier */}
      <div className="flex items-center justify-center gap-3">
        <button
          onClick={() => setModifier(Math.max(-10, modifier - 1))}
          className="w-12 h-12 bg-gray-700 rounded-lg font-bold text-xl"
        >
          -
        </button>
        <div className="w-20 text-center">
          <div className="text-sm text-gray-400">Modifier</div>
          <div className="text-2xl font-bold">{modifier >= 0 ? '+' : ''}{modifier}</div>
        </div>
        <button
          onClick={() => setModifier(Math.min(10, modifier + 1))}
          className="w-12 h-12 bg-gray-700 rounded-lg font-bold text-xl"
        >
          +
        </button>
      </div>

      {/* Roll button: Large touch target */}
      <Button
        onClick={rollDice}
        className="w-full h-16 text-xl font-bold"
        size="lg"
      >
        Roll d{selectedDice}{modifier !== 0 && ` ${modifier >= 0 ? '+' : ''}${modifier}`}
      </Button>
    </div>
  );
}
```

### Mobile Combat Tracker
```typescript
// apps/web/src/components/CombatTrackerMobile.tsx
'use client';

import { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { motion, PanInfo } from 'framer-motion';

interface Combatant {
  id: string;
  name: string;
  hp: number;
  maxHp: number;
  ac: number;
  isCurrentTurn: boolean;
}

export function CombatTrackerMobile({ combatants }: { combatants: Combatant[] }) {
  const handleSwipe = (combatantId: string, info: PanInfo) => {
    if (info.offset.x < -100) {
      // Swiped left: show actions
      console.log('Show actions for', combatantId);
    }
  };

  return (
    <div className="space-y-3 p-4">
      {combatants.map((combatant) => (
        <motion.div
          key={combatant.id}
          drag="x"
          dragConstraints={{ left: -150, right: 0 }}
          onDragEnd={(_, info) => handleSwipe(combatant.id, info)}
        >
          <Card
            className={`${
              combatant.isCurrentTurn
                ? 'border-2 border-blue-500 shadow-lg'
                : ''
            }`}
          >
            <CardContent className="p-4">
              <div className="flex items-center justify-between mb-2">
                <div>
                  <h3 className="font-bold text-lg">{combatant.name}</h3>
                  <p className="text-sm text-gray-400">AC {combatant.ac}</p>
                </div>
                <div className="text-right">
                  <div className="text-2xl font-bold">
                    {combatant.hp}/{combatant.maxHp}
                  </div>
                  <div className="text-xs text-gray-400">HP</div>
                </div>
              </div>

              <Progress
                value={(combatant.hp / combatant.maxHp) * 100}
                className="h-2"
              />
            </CardContent>
          </Card>
        </motion.div>
      ))}
    </div>
  );
}
```

### Pull-to-Refresh Component
```bash
pnpm add react-use-gesture
```

```typescript
// apps/web/src/components/PullToRefresh.tsx
'use client';

import { useState } from 'react';
import { useDrag } from '@use-gesture/react';
import { animated, useSpring } from '@react-spring/web';

interface PullToRefreshProps {
  onRefresh: () => Promise<void>;
  children: React.ReactNode;
}

export function PullToRefresh({ onRefresh, children }: PullToRefreshProps) {
  const [isRefreshing, setIsRefreshing] = useState(false);

  const [{ y }, api] = useSpring(() => ({ y: 0 }));

  const bind = useDrag(
    ({ down, movement: [, my] }) => {
      if (my < 0) return; // Only pull down

      if (!down && my > 80) {
        // Trigger refresh
        setIsRefreshing(true);
        onRefresh().finally(() => {
          setIsRefreshing(false);
          api.start({ y: 0 });
        });
      } else if (down) {
        api.start({ y: Math.min(my, 120) });
      } else {
        api.start({ y: 0 });
      }
    },
    { axis: 'y' }
  );

  return (
    <div className="relative overflow-hidden">
      {/* Refresh indicator */}
      <animated.div
        style={{ y }}
        className="absolute top-0 left-0 right-0 flex justify-center py-4"
      >
        <div className="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin" />
      </animated.div>

      {/* Content */}
      <animated.div {...bind()} style={{ y }}>
        {children}
      </animated.div>
    </div>
  );
}
```

**Usage:**
```typescript
<PullToRefresh onRefresh={async () => await refetchTables()}>
  <TableList tables={tables} />
</PullToRefresh>
```

### Touch Target Optimization
**[Source: Apple Human Interface Guidelines - Touch Targets]**

```css
/* apps/web/src/styles/touch.css */

/* Minimum touch target: 44x44px */
.touch-target {
  min-height: 44px;
  min-width: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Increase padding on mobile inputs */
@media (max-width: 768px) {
  input,
  textarea,
  select {
    padding: 12px 16px;
    font-size: 16px; /* Prevents zoom on iOS */
  }

  button {
    min-height: 44px;
    padding: 12px 20px;
  }

  /* Larger checkboxes/radios */
  input[type='checkbox'],
  input[type='radio'] {
    width: 24px;
    height: 24px;
  }
}
```

### Viewport Meta Tag
```html
<!-- apps/web/src/app/layout.tsx -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
```

### Testing

**Test scenarios:**
- All pages render correctly at 320px, 640px, 768px, 1024px, 1280px
- Navigation collapses to hamburger menu below 768px
- Hamburger menu opens/closes correctly
- Character sheet stacks to single column on mobile
- Ability scores show 3x2 grid on mobile
- Table page shows bottom sheet on mobile
- Bottom sheet swipes up/down correctly
- Dice roller buttons are 44px+ height
- Dice roller modifier buttons work on touch
- Combat tracker cards swipe left to reveal actions
- Tables discovery scrolls vertically on mobile
- Pull-to-refresh triggers refresh action
- All touch targets are 44px+ with adequate spacing
- Test on iPhone Safari, Android Chrome
- Test landscape and portrait orientations
- Haptic feedback works on supported devices

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story draft | Bob (SM) |

## Dev Agent Record
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_
