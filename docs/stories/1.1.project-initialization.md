# Story 1.1: Project Initialization

## Status
Draft

## Story
**As a** Developer,
**I want** to initialize the IA-RPG monorepo project structure with all necessary configuration files,
**so that** the development team can begin implementing features with a properly configured development environment.

## Acceptance Criteria
1. Monorepo structure is created following the Architecture specification (pnpm workspaces + Turborepo)
2. All workspace packages (`apps/web`, `apps/api`, `packages/shared`, `packages/ui`, `packages/db`, `packages/config`) are scaffolded with proper TypeScript configuration
3. Root-level configuration files are in place (`pnpm-workspace.yaml`, `turbo.json`, `tsconfig.json`, `.gitignore`, `.env.example`)
4. Package.json scripts for `dev`, `build`, `test`, `lint`, `typecheck` are functional
5. Git repository is initialized with initial commit
6. README.md documents setup instructions and project structure
7. All packages have correct `package.json` with proper workspace dependencies

## Tasks / Subtasks

- [ ] Initialize Git repository and monorepo structure (AC: 1, 5)
  - [ ] Run `git init` in project root
  - [ ] Create `.gitignore` with Node.js, Next.js, and Prisma patterns
  - [ ] Create directory structure for monorepo (apps/, packages/, docs/, scripts/)

- [ ] Configure pnpm workspaces (AC: 1, 2)
  - [ ] Create `pnpm-workspace.yaml` with workspace patterns
  - [ ] Create root `package.json` with workspace scripts
  - [ ] Install pnpm globally if not present

- [ ] Configure Turborepo (AC: 1, 4)
  - [ ] Create `turbo.json` with pipeline configuration
  - [ ] Add Turborepo to root devDependencies
  - [ ] Configure build/test/lint/dev tasks with proper dependencies

- [ ] Scaffold frontend workspace (apps/web) (AC: 2, 7)
  - [ ] Initialize Next.js 14.2+ with App Router and TypeScript
  - [ ] Create directory structure (app/, components/, hooks/, lib/, stores/, styles/)
  - [ ] Configure `next.config.js` with strict TypeScript mode
  - [ ] Create `tsconfig.json` extending workspace config
  - [ ] Set up `package.json` with workspace dependencies

- [ ] Scaffold backend workspace (apps/api) (AC: 2, 7)
  - [ ] Initialize Express.js project with TypeScript
  - [ ] Create directory structure (routes/, controllers/, services/, repositories/, middleware/, socket/, utils/, config/)
  - [ ] Create `server.ts` entry point file
  - [ ] Configure `tsconfig.json` for Node.js
  - [ ] Set up `package.json` with dependencies (Express, Socket.io, etc.)

- [ ] Create shared packages workspace (packages/shared) (AC: 2, 7)
  - [ ] Initialize TypeScript package for shared types
  - [ ] Create directory structure (types/, validators/, constants/, utils/)
  - [ ] Create `index.ts` with exports
  - [ ] Configure `tsconfig.json` for library output
  - [ ] Set up `package.json` with proper exports field

- [ ] Create UI components workspace (packages/ui) (AC: 2, 7)
  - [ ] Initialize shadcn/ui package structure
  - [ ] Create `components/` directory for shadcn components
  - [ ] Set up TailwindCSS configuration (shared)
  - [ ] Create `index.ts` with component exports
  - [ ] Configure `package.json` with Radix UI dependencies

- [ ] Create database workspace (packages/db) (AC: 2, 7)
  - [ ] Initialize Prisma in packages/db
  - [ ] Create `prisma/schema.prisma` file (empty schema for now)
  - [ ] Create `prisma/migrations/` directory
  - [ ] Create `src/index.ts` exporting Prisma client
  - [ ] Configure `package.json` with Prisma dependencies

- [ ] Create config workspace (packages/config) (AC: 2, 7)
  - [ ] Create `eslint/index.js` with shared ESLint config
  - [ ] Create `typescript/base.json` with shared TypeScript config
  - [ ] Create `jest/jest.config.js` for shared test config
  - [ ] Set up `package.json` with config tool dependencies

- [ ] Create root-level configuration files (AC: 3)
  - [ ] Create `.env.example` with all required environment variables
  - [ ] Create root `tsconfig.json` with base settings
  - [ ] Create `.eslintrc.js` extending workspace config
  - [ ] Create `.prettierrc` for code formatting

- [ ] Verify workspace dependencies (AC: 7)
  - [ ] Run `pnpm install` to verify workspace links
  - [ ] Test cross-package imports (e.g., apps/web importing @iarpg/shared)
  - [ ] Verify Turborepo can detect all workspaces

- [ ] Test monorepo scripts (AC: 4)
  - [ ] Run `pnpm dev` to start both web and api in parallel
  - [ ] Run `pnpm lint` to lint all workspaces
  - [ ] Run `pnpm typecheck` to verify TypeScript compilation
  - [ ] Run `pnpm build` to build all workspaces

- [ ] Create project documentation (AC: 6)
  - [ ] Create `README.md` with project overview
  - [ ] Document prerequisites (Node.js 20+, pnpm)
  - [ ] Document setup instructions (clone, install, configure env, run)
  - [ ] Document workspace structure and purpose of each package
  - [ ] Document available scripts (`dev`, `build`, `test`, `lint`)

- [ ] Create initial commit (AC: 5)
  - [ ] Stage all files
  - [ ] Create commit: `feat: initialize IA-RPG monorepo structure [Story 1.1]`
  - [ ] Verify commit history

## Dev Notes

### Project Structure Reference
**[Source: Architecture Section 12 - Unified Project Structure]**

Complete monorepo structure to create:

```
iarpg/
├── .github/
│   └── workflows/          # CI/CD (future stories)
├── apps/
│   ├── web/                # Next.js 14.2+ (App Router)
│   │   ├── src/
│   │   │   ├── app/        # App Router pages
│   │   │   ├── components/ # React components
│   │   │   ├── hooks/      # Custom hooks
│   │   │   ├── lib/        # API client, utilities
│   │   │   ├── stores/     # Zustand stores
│   │   │   └── styles/     # Global CSS
│   │   ├── public/         # Static assets
│   │   ├── tests/          # Vitest tests
│   │   ├── next.config.js
│   │   ├── tailwind.config.js
│   │   ├── tsconfig.json
│   │   └── package.json
│   └── api/                # Express.js 4.19+
│       ├── src/
│       │   ├── routes/     # API routes
│       │   ├── controllers/# Controllers
│       │   ├── services/   # Business logic
│       │   ├── repositories/ # Data access
│       │   ├── middleware/ # Express middleware
│       │   ├── socket/     # Socket.io server + handlers
│       │   ├── utils/      # Utilities
│       │   ├── config/     # Config loader
│       │   └── server.ts   # Entry point
│       ├── tests/          # Vitest tests
│       ├── tsconfig.json
│       └── package.json
├── packages/
│   ├── shared/             # Shared TypeScript types
│   │   ├── src/
│   │   │   ├── types/      # Interfaces
│   │   │   ├── validators/ # Zod schemas
│   │   │   ├── constants/  # Constants
│   │   │   └── utils/      # Utilities
│   │   ├── tsconfig.json
│   │   └── package.json
│   ├── ui/                 # shadcn/ui components
│   │   ├── src/
│   │   │   ├── components/ # UI components
│   │   │   └── index.ts
│   │   ├── tailwind.config.js
│   │   ├── tsconfig.json
│   │   └── package.json
│   ├── db/                 # Prisma
│   │   ├── prisma/
│   │   │   ├── schema.prisma
│   │   │   ├── migrations/
│   │   │   └── seed.ts
│   │   ├── src/
│   │   │   └── index.ts    # Export Prisma client
│   │   ├── tsconfig.json
│   │   └── package.json
│   └── config/             # Shared configs
│       ├── eslint/
│       ├── typescript/
│       └── jest/
├── docs/
│   ├── prd.md
│   ├── front-end-spec.md
│   └── fullstack-architecture.md
├── scripts/
│   ├── seed-db.ts
│   └── setup.sh
├── .env.example
├── .gitignore
├── package.json            # Root workspace
├── pnpm-workspace.yaml
├── turbo.json
├── README.md
└── tsconfig.json
```

### Workspace Configuration Files
**[Source: Architecture Section 12 - Unified Project Structure]**

**`pnpm-workspace.yaml`:**
```yaml
packages:
  - "apps/*"
  - "packages/*"
```

**`turbo.json`:**
```json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "dist/**"]
    },
    "test": {
      "dependsOn": ["build"],
      "outputs": []
    },
    "lint": {
      "outputs": []
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

**Root `package.json` scripts:**
```json
{
  "name": "iarpg",
  "private": true,
  "scripts": {
    "dev": "turbo run dev --parallel",
    "build": "turbo run build",
    "test": "turbo run test",
    "lint": "turbo run lint",
    "typecheck": "turbo run typecheck",
    "db:migrate": "pnpm --filter @iarpg/db prisma migrate dev",
    "db:studio": "pnpm --filter @iarpg/db prisma studio"
  },
  "devDependencies": {
    "turbo": "^2.0.0",
    "typescript": "^5.3.0"
  }
}
```

### Technology Stack Versions
**[Source: Architecture Section 3 - Tech Stack]**

**Frontend:**
- Next.js: **14.2+** (with App Router)
- TypeScript: **5.3+**
- React: **18+**
- TailwindCSS: **3.4+**
- shadcn/ui: **latest**
- Zustand: **4.5+**

**Backend:**
- Node.js: **20 LTS**
- Express.js: **4.19+**
- TypeScript: **5.3+**
- Socket.io: **4.7+**
- Prisma: **5.20+**

**Monorepo:**
- pnpm: **9+**
- Turborepo: **2.0+**

**Testing:**
- Vitest: **1.6+**
- Playwright: **1.45+**
- Testing Library (React): **15+**

**Tools:**
- ESLint: **8+**
- Prettier: **3+**
- TypeScript ESLint: **7+**

### Package Naming Convention
**[Source: Architecture Section 12]**

All workspace packages use `@iarpg/` scope:
- `@iarpg/web` - Frontend app
- `@iarpg/api` - Backend app
- `@iarpg/shared` - Shared types
- `@iarpg/ui` - UI components
- `@iarpg/db` - Prisma client
- `@iarpg/config` - Shared configs

### Environment Variables Template
**[Source: Architecture Section 14.2 - Deployment Architecture]**

Create `.env.example` with:
```bash
# Database (Supabase)
DATABASE_URL="postgresql://user:password@host:5432/iarpg?schema=public"
DIRECT_URL="postgresql://user:password@host:5432/iarpg?schema=public"

# NextAuth.js
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="generate-with-openssl-rand-base64-32"

# Supabase
NEXT_PUBLIC_SUPABASE_URL="https://xxxxx.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="your-anon-key"
SUPABASE_SERVICE_KEY="your-service-key"

# OpenAI (for AI features - Epic 6)
OPENAI_API_KEY="sk-..."

# Anthropic Claude (fallback - Epic 6)
ANTHROPIC_API_KEY="sk-ant-..."

# Redis (Upstash - for caching)
REDIS_URL="redis://default:xxx@xxx.upstash.io:6379"

# Email (Resend)
RESEND_API_KEY="re_..."

# Monitoring (future)
SENTRY_DSN=""
NEXT_PUBLIC_POSTHOG_KEY=""
NEXT_PUBLIC_POSTHOG_HOST="https://app.posthog.com"

# Stripe (Epic 8 - Monetization)
STRIPE_SECRET_KEY="sk_test_..."
STRIPE_PUBLISHABLE_KEY="pk_test_..."
STRIPE_WEBHOOK_SECRET="whsec_..."

# Server
PORT=3001
NODE_ENV=development
```

### Git Ignore Patterns
**[Source: Standard Next.js + Node.js patterns]**

Essential patterns for `.gitignore`:
```
# Dependencies
node_modules/
.pnp/
.pnp.js

# Testing
coverage/

# Next.js
.next/
out/
build/
dist/

# Misc
.DS_Store
*.pem

# Debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# Local env files
.env
.env*.local

# Vercel
.vercel

# Turbo
.turbo

# Prisma
prisma/migrations/**/migration.sql
```

### TypeScript Configuration Strategy
**[Source: Architecture Section 17 - Coding Standards]**

- Use TypeScript **strict mode** in all packages
- Enable `noUncheckedIndexedAccess` for array safety
- Enable `strictNullChecks` for null safety
- Use `moduleResolution: "bundler"` for modern imports
- Set `target: "ES2022"` for Node.js 20 compatibility

**Root `tsconfig.json`:**
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "incremental": true
  }
}
```

### Next.js Configuration
**[Source: Architecture Section 10.1 - Frontend Architecture]**

**`apps/web/next.config.js`:**
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  typescript: {
    ignoreBuildErrors: false,
  },
  eslint: {
    ignoreDuringBuilds: false,
  },
  experimental: {
    typedRoutes: true,
  },
  transpilePackages: ['@iarpg/ui', '@iarpg/shared'],
};

module.exports = nextConfig;
```

### Express.js Entry Point
**[Source: Architecture Section 11.1 - Backend Architecture]**

**`apps/api/src/server.ts` structure:**
```typescript
import express from 'express';
import { createServer } from 'http';
import { Server as SocketIOServer } from 'socket.io';

const app = express();
const httpServer = createServer(app);
const io = new SocketIOServer(httpServer);

const PORT = process.env.PORT || 3001;

// Middleware setup (future stories)
// Routes setup (future stories)
// Socket.io setup (future stories)

httpServer.listen(PORT, () => {
  console.log(`API server running on port ${PORT}`);
});
```

### Workspace Dependency Examples
**[Source: Architecture Section 12]**

**`apps/web/package.json`:**
```json
{
  "name": "@iarpg/web",
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "@iarpg/shared": "workspace:*",
    "@iarpg/ui": "workspace:*",
    "@iarpg/db": "workspace:*"
  }
}
```

**`apps/api/package.json`:**
```json
{
  "name": "@iarpg/api",
  "dependencies": {
    "express": "^4.19.0",
    "socket.io": "^4.7.0",
    "@iarpg/shared": "workspace:*",
    "@iarpg/db": "workspace:*"
  }
}
```

### Development Workflow Commands
**[Source: Architecture Section 13.1 - Development Workflow]**

After initialization, developers should be able to run:

```bash
# Install all workspace dependencies
pnpm install

# Start all apps in development mode (parallel)
pnpm dev

# Build all workspaces
pnpm build

# Run all tests
pnpm test

# Lint all workspaces
pnpm lint

# Type-check all workspaces
pnpm typecheck

# Run Prisma migrations
pnpm db:migrate

# Open Prisma Studio
pnpm db:studio
```

### Testing

**Test Framework:** Vitest 1.6+
**Test File Location:** Each workspace has its own `tests/` directory
**Test File Naming:** `*.test.ts` or `*.spec.ts`

**Testing Standards:**
**[Source: Architecture Section 16 - Testing Strategy]**

- All packages should have `vitest` configured
- Frontend tests use `@testing-library/react`
- Backend tests use Vitest with Node.js environment
- Test files located in `tests/` directory within each workspace
- Shared test utilities in `packages/config/jest/`

**For this story:** No specific tests required (infrastructure setup), but ensure test infrastructure is ready for future stories.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story draft | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_
