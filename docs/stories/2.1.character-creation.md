# Story 2.1: Character Creation (Quick Start + Guided)

## Status
✅ Complete

## Story
**As a** User,
**I want** to create D&D 5e characters using either Quick Start (pre-made) or Guided Creation (step-by-step),
**so that** I can have a character ready to join tables without complex character building.

## Acceptance Criteria
1. Character creation page is accessible at `/characters/new`
2. User can choose between "Quick Start" (6 pre-made characters) or "Guided Creation"
3. Quick Start displays 6 pre-made characters with race, class, level, and preview stats
4. Quick Start allows selecting a character and customizing name only
5. Guided Creation has 5 steps: Race → Class → Ability Scores → Equipment → Review
6. Ability Scores step supports Point Buy and Standard Array methods
7. Character is saved to database with all D&D 5e fields populated
8. After creation, user is redirected to character sheet page

## Tasks / Subtasks

- [x] Create character creation page (AC: 1)
  - [x] Create `/characters/new` route in apps/web
  - [x] Create layout with "Quick Start" vs "Guided Creation" toggle
  - [x] Add progress indicator for Guided Creation (5 steps)

- [x] Implement Quick Start flow (AC: 2, 3, 4)
  - [x] Define 6 pre-made characters (Fighter, Wizard, Rogue, Cleric, Ranger, Bard)
  - [x] Create character card component showing race, class, level, key stats
  - [x] Add "Select" button for each pre-made character
  - [x] Show name input modal when character selected
  - [x] Submit character to API with pre-filled data

- [x] Implement Guided Creation - Step 1: Race (AC: 5)
  - [x] Display 9 D&D 5e races (Human, Elf, Dwarf, Halfling, Dragonborn, Gnome, Half-Elf, Half-Orc, Tiefling)
  - [x] Show race description and ability score modifiers
  - [x] Store selection in form state
  - [x] Navigate to Step 2

- [x] Implement Guided Creation - Step 2: Class (AC: 5)
  - [x] Display 12 D&D 5e classes (Barbarian, Bard, Cleric, Druid, Fighter, Monk, Paladin, Ranger, Rogue, Sorcerer, Warlock, Wizard)
  - [x] Show class description, hit die, primary ability
  - [x] Store selection in form state
  - [x] Navigate to Step 3

- [x] Implement Guided Creation - Step 3: Ability Scores (AC: 5, 6)
  - [x] Add toggle: "Point Buy" vs "Standard Array"
  - [x] Point Buy: 27 points, costs table (8=0, 9=1, ... 15=9)
  - [x] Standard Array: pre-set values [15, 14, 13, 12, 10, 8] to assign
  - [x] Apply racial bonuses automatically
  - [x] Show final ability scores and modifiers
  - [x] Navigate to Step 4

- [x] Implement Guided Creation - Step 4: Equipment (AC: 5)
  - [x] Display starting equipment for selected class
  - [x] Allow choosing between equipment packages (A or B)
  - [x] Store equipment list in form state
  - [x] Navigate to Step 5

- [x] Implement Guided Creation - Step 5: Review (AC: 5)
  - [x] Display full character summary (race, class, abilities, equipment)
  - [x] Add name and background text inputs
  - [x] Add "Create Character" button
  - [x] Show loading state during creation

- [x] Create character creation API endpoint (AC: 7)
  - [x] POST `/api/characters` endpoint
  - [x] Validate required fields (name, race, class, ability scores)
  - [x] Calculate derived stats (HP, AC, proficiency bonus, initiative)
  - [x] Save character to database via Prisma
  - [x] Return created character with ID

- [x] Calculate D&D 5e stats (AC: 7)
  - [x] HP: class hit die + CON modifier
  - [x] AC: 10 + DEX modifier (base, armor added later)
  - [x] Proficiency bonus: +2 (level 1)
  - [x] Initiative: DEX modifier
  - [x] Speed: 30 (race-specific)
  - [x] Saving throw proficiencies (class-based)
  - [x] Skill proficiencies (class + background)

- [x] Handle post-creation redirect (AC: 8)
  - [x] After successful creation, redirect to `/characters/{id}`
  - [x] Clear form state

## Dev Notes

### Quick Start Pre-Made Characters
**[Source: PRD FR4 - Quick Start with 6 pre-made characters]**

**6 Pre-Made Characters (Level 1):**

1. **Human Fighter** - Str 16, Dex 14, Con 15, Int 10, Wis 12, Cha 8
2. **Elf Wizard** - Str 8, Dex 16, Con 12, Int 16, Wis 13, Cha 10
3. **Halfling Rogue** - Str 10, Dex 17, Con 12, Int 13, Wis 14, Cha 8
4. **Dwarf Cleric** - Str 14, Dex 10, Con 16, Int 8, Wis 16, Cha 12
5. **Human Ranger** - Str 14, Dex 16, Con 13, Int 10, Wis 15, Cha 8
6. **Half-Elf Paladin** - Str 16, Dex 10, Con 14, Int 8, Wis 12, Cha 15

### Point Buy System
**[Source: PRD FR7 - Point Buy and Standard Array]**

**Point Buy Rules:**
- Start with 27 points
- Base ability scores: 8 (costs 0 points)
- Cost table:
  - 8: 0 pts, 9: 1 pt, 10: 2 pts, 11: 3 pts, 12: 4 pts, 13: 5 pts, 14: 7 pts, 15: 9 pts
- Max score: 15 before racial bonuses
- Apply racial bonuses after point allocation

**Standard Array:**
- Pre-set values: [15, 14, 13, 12, 10, 8]
- Assign one value to each ability score
- Apply racial bonuses after assignment

### Character Data Model
**[Source: Architecture Section 4.2 - Character Model]**

**Required fields:**
```typescript
{
  userId: string;
  name: string;
  race: string;
  class: string;
  level: number; // Always 1 for new characters

  // Ability Scores
  strength: number;
  dexterity: number;
  constitution: number;
  intelligence: number;
  wisdom: number;
  charisma: number;

  // Calculated Stats
  proficiencyBonus: number; // +2 at level 1
  hp: number;
  maxHp: number;
  ac: number;
  initiative: number;
  speed: number;

  // JSON fields
  proficiencies: string[]; // ["Perception", "Athletics"]
  equipment: EquipmentItem[];

  background: string;
}
```

### API Endpoint
**[Source: Architecture Section 5.1.3 - Character Endpoints]**

**POST /api/characters:**
```typescript
// Request
{
  name: "Thorin Ironforge",
  race: "Dwarf",
  class: "Fighter",
  level: 1,
  strength: 16,
  dexterity: 14,
  constitution: 15,
  intelligence: 10,
  wisdom: 12,
  charisma: 8,
  background: "Soldier",
  proficiencies: ["Athletics", "Intimidation"],
  equipment: [...]
}

// Response 201
{
  character: Character
}
```

### UI Components
**[Source: Front-End Spec Section 6 - Component Library]**

Use shadcn/ui components:
- **Card** - For character selection cards
- **Button** - Primary actions
- **Input** - Name field
- **RadioGroup** - Race/class selection
- **Tabs** - Quick Start vs Guided toggle
- **Progress** - Step indicator

### Form State Management
**[Source: Best practices for multi-step forms]**

Use React state or Zustand store:
```typescript
interface CharacterFormState {
  step: number; // 1-5
  name: string;
  race: string;
  class: string;
  abilityScores: {
    str: number;
    dex: number;
    con: number;
    int: number;
    wis: number;
    cha: number;
  };
  equipment: EquipmentItem[];
  background: string;
}
```

### Testing

**Test scenarios:**
- User can complete Quick Start flow
- User can complete Guided Creation flow with Point Buy
- User can complete Guided Creation flow with Standard Array
- Character is saved to database correctly
- Ability score modifiers apply racial bonuses
- Derived stats (HP, AC) calculate correctly
- Redirect to character sheet after creation

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story draft | Bob (SM) |

## Dev Agent Record

**Implementation Date:** 2025-10-01
**Implemented By:** James (Dev Agent)
**Commit:** 34bdcda

### Files Created:
- `apps/web/src/lib/character-data.ts` - D&D 5e data and calculations (350+ lines)
- `apps/web/src/app/characters/new/page.tsx` - Character creation page
- `apps/web/src/app/characters/page.tsx` - Characters list page
- `apps/web/src/app/characters/[id]/page.tsx` - Character detail page
- `apps/web/src/components/character-creation/quick-start-flow.tsx` - Quick Start component
- `apps/web/src/components/character-creation/guided-creation-flow.tsx` - Guided Creation main flow
- `apps/web/src/components/character-creation/steps/step-race.tsx` - Step 1
- `apps/web/src/components/character-creation/steps/step-class.tsx` - Step 2
- `apps/web/src/components/character-creation/steps/step-ability-scores.tsx` - Step 3 (200+ lines)
- `apps/web/src/components/character-creation/steps/step-equipment.tsx` - Step 4
- `apps/web/src/components/character-creation/steps/step-review.tsx` - Step 5
- `apps/api/src/routes/characters.routes.ts` - Character API endpoints

### Files Modified:
- `apps/api/src/routes/index.ts` - Added character routes
- `apps/web/src/app/login/page.tsx` - Fixed lint error (escaped apostrophe)

### Implementation Notes:
- Implemented complete Point Buy system with real-time cost calculation
- Standard Array properly removes selected values from pool
- All 9 D&D 5e races with accurate ability bonuses and descriptions
- All 12 D&D 5e classes with hit dice and starting equipment
- API calculates derived stats (HP, AC, initiative) server-side
- TypeScript fully typed with interfaces
- All lint and typecheck passed

### Testing:
✅ TypeScript typecheck passed
✅ ESLint passed
✅ All components properly typed

## QA Results
_To be filled by QA agent_
